# Stage 1: Build Vue app with Vite
FROM node:18-alpine AS builder

WORKDIR /app

# Copiar package.json y package-lock.json
COPY package*.json ./

# Instalar dependencias
RUN npm install

# Copiar c칩digo fuente
COPY src/ ./src/
COPY vite.config.js ./
COPY index.html ./

# Compilar la aplicaci칩n
RUN npm run build

# Stage 2: Servir con Nginx
FROM nginx:alpine

# Copiar la carpeta dist compilada desde el stage anterior
COPY --from=builder /app/dist /usr/share/nginx/html/

# Copiar im치genes est치ticas del repo al html de nginx
COPY imagenes/ /usr/share/nginx/html/imagenes/

# Copiar JSONs de datos al html para que el frontend pueda cargarlos
COPY canchas.json /usr/share/nginx/html/canchas.json
COPY reservas.json /usr/share/nginx/html/reservas.json
COPY feedbacks.json /usr/share/nginx/html/feedbacks.json

# Exponer el puerto 80
EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]